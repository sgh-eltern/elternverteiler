#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift(File.expand_path('../lib', __dir__))

require 'sequel'
Sequel::Model.db = Sequel.connect(ENV.fetch('DB'))
Sequel.extension :migration
Sequel::Migrator.run(Sequel::Model.db, 'db/migrations')

require 'sgh/elternverteiler'
include SGH::Elternverteiler
require 'sgh/elternverteiler/postmap_presenter'

# Klasse.each do |klasse|
#   puts PostmapPresenter.new("eltern-#{klasse.name.downcase}@schickhardt-gymnasium-herrenberg.de").present(klasse.eltern)
# end

Sch√ºler.to_hash_groups(:klasse).each do |klasse, schueler|
  parents = schueler.collect(&:eltern).flatten.uniq
  puts PostmapPresenter.new("eltern-#{klasse.downcase}@schickhardt-gymnasium-herrenberg.de").present(parents)
end

if Erziehungsberechtigter.any?
  eltern = Erziehungsberechtigter.all
  puts PostmapPresenter.new('eltern@schickhardt-gymnasium-herrenberg.de').present(eltern)
end
